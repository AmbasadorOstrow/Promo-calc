<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Rabat√≥w</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        button { margin-top: 10px; padding: 10px; }
    </style>
</head>
<body>

    <h2>Kalkulator Rabat√≥w</h2>

    <table id="productTable">
        <tr>
            <th>Nazwa</th>
            <th>Cena Regularna</th>
            <th>Cena po Kodzie</th>
            <th>Usu≈Ñ</th>
        </tr>
    </table>

    <button onclick="addProduct()">Dodaj produkt</button>
    <button onclick="calculateDiscount()">Oblicz rabat</button>

    <h3>Wynik:</h3>
    <div id="result"></div>

    <script>
        function addProduct() {
            const table = document.getElementById("productTable");
            const row = table.insertRow(-1);

            const nameCell = row.insertCell(0);
            const priceCell = row.insertCell(1);
            const discountCell = row.insertCell(2);
            const deleteCell = row.insertCell(3);

            nameCell.innerHTML = `<input type="text" placeholder="Nazwa">`;
            priceCell.innerHTML = `<input type="number" placeholder="Cena regularna">`;
            discountCell.innerHTML = `<input type="number" placeholder="Cena po kodzie">`;
            deleteCell.innerHTML = `<button onclick="deleteRow(this)">üóë</button>`;
        }

        function deleteRow(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        async function calculateDiscount() {
            const table = document.getElementById("productTable");
            const rows = table.getElementsByTagName("tr");
            const products = [];

            for (let i = 1; i < rows.length; i++) {
                const inputs = rows[i].getElementsByTagName("input");
                if (inputs.length === 3) {
                    const name = inputs[0].value.trim();
                    const regular_price = parseFloat(inputs[1].value);
                    const discount_price = parseFloat(inputs[2].value);

                    if (name && !isNaN(regular_price) && !isNaN(discount_price)) {
                        products.push({ name, regular_price, discount_price });
                    }
                }
            }

            if (products.length < 2) {
                alert("Dodaj co najmniej 2 produkty!");
                return;
            }

            const response = await fetch("https://promo-calc.onrender.com/calculate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(products),
            });

            const data = await response.json();
            displayResult(data);
        }

        function displayResult(data) {
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = `<strong>Ca≈Çkowity koszt:</strong> ${data.total_price.toFixed(2)} z≈Ç`;

            data.orders.forEach(order => {
                resultDiv.innerHTML += `<h4>Zam√≥wienie ${order.order}</h4><ul>`;
                order.products.forEach(p => {
                    resultDiv.innerHTML += `<li>${p.name}: ${p.discount_price.toFixed(2)} z≈Ç</li>`;
                });
                resultDiv.innerHTML += `</ul><strong>Koszt po rabacie: ${order.final_price.toFixed(2)} z≈Ç</strong>`;
            });
        }
    </script>

</body>
</html>